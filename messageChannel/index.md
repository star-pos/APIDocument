# 消息通道

## 使用方式

提供机构号以及接收通知的服务器地址给对接人员即可完成配置。开发者需要按照本文档的返回参数返回json

## 通讯协议

| 传输方式 | 通讯采用HTTP方式 |
| :---: | :--- |
| 提交方式 | 采用POST请求 |
| 字符编码 | 请求交易报文中的编码方式默认为GBK |
| 报文格式 | 以json做为数据传输格式 注:“Content-Type","application/json” |

##安全规范
测试用证书：找开发获取（也可以在合作商信息维护界面下载机构唯一）    
 
测试用MD5KEY: 找开发获取（也可以在合作商信息维护界面查询机构唯一）
（例：e10adc3949ba59abbe56e057f20f883e）
 
例如推送接口的请求原数据为：

`{"logNo":"201804270298407869","UserId":"","BalDate":"20180427","AgentId":"172","TxnLogId":"9115248173556540156342038","BusinessId":"800461000001090","SDTermNo":"95126798","TxnCode":"N001","PayChannel":"2","TxnDate":"20180427","TxnTime":"162238","TxnAmt":"43.9","TxnStatus":"1","BankType":"","OfficeId":"91524817356294700943","ChannelId":"9115248173556540156342038","attach":"","CrdFlg":""}`


将请求数据通过req_rsa_public_key.pem加密后，生成报文中pubDate的值。
pubDate为：
`69B6F0FC21D74E8521C0FD2D4E5FF2F1597BD1FA4E4E96D6F8EA0158F23E744751CA10B4FE001AFAFE407A4188F50177003A275EBEF1785413D653DA28A9F2FEE9A8FCA67146980D270BB7C895DBEF328FEC5212451FDF23B142654BD5313B03726A0494504DB005F1BBC77E83654B5C0FEDBC25C36B2FCF83FD0AA1082B0244BBBFFA62E6B46B6AE0A6EB607B2E464204E106B5CD38257D7237AE8ADA4C0A5F8ED49DE39826F4B7C3B7FD62B1AECB8E8086536BBCC19121EFA676D6FBA4BC4E43BC2E9EB59173C4CBEA92EB2FAD08B0F6C91E45DC442DD8BB772D4D207B63A15531387EC5B9CAE7A334A8AFC8E352EA638D5E97B3F2BF09DDFFDC79845E04C785AD52991743240DB7A8180DC8CC586C845098EE1644324FF93DC3A0D6853F6838CFDA431F4035F998426B94E71C4C8BA602CEFF752B8573D502BE73AE733B1A44B3C61D238AA8BB08AA31FC2EC3B896B2CB83B74F176E8EE7C7B97FF2578F230A4FADDAE9934E928F8939372D4F094B804F5C9C2F6C4B58D6A900384A278B41CA16589DE05A30DEDA7C19D0209FBE445BF513622A69D0AA963BC10C760C6E0FADAA9A5C7C74E4ABBF69B42534AA9FF4988434B9C87DF155D96965A35EC9472FAD146AC80F0D470428072A255076B845D1B8F88264863EB070859834E28C66C58FB67BB759B39C06AB774B2E57D0BF4AC361B8B6071AB186EC44A715D11F4F6D`
 
txnData拼接MD5KEY后，计算md5值做为signValue。
 
值：计算md5的值为：C6722327ADBEA235FD8808BB26022715
 
选择加密加签之后 接口的最终请求数据为：
`{"Datas":"4222541DF5EA7A1A676A16AE51F77DD2EA89233B26E12A2807679091891B8B935AE1CEBA76968D281895CC3ED53A3DE60E0B199A6DE44727F37CE68756E846E518464EA7AD435C820CD486DDF4D3711AEEE063481431291119451287085E9C854C76EA91F0A18F78AD50F9EF68DD4FE9D3373CD089A20983283E75966E92020CBF6D72ACEB0EE2F38820B04BACBC9E0ED23D46461C9FAF4014F3E53C8F36B8C4F683D31C8D5F7503F5A247E44D721242C5B12872BBC65E2D52FDA23180138197CA676B1EE845635B0AB752DB08276589E164A380EF543F626A35B86634752A99BEB2DF95A94090F998D290E72A1CABCC5F55CF50CFD42D3350B23488F7CD4F7CA9C8D5F0FECEE7DF488750F1A13010057380C5872EC9952CF9141F3C438EC0886128AACB18FC76BC51AA64295F890E3760B6FDE84DAE350D82B8A8ADCA37C869A1492852AFD35747D67073D0A130F4DB844D2AEF910A12B3B41015D9ADEEA4AEBCCF52BF13F2BF77600593ADC529079C4C2D468E24B5ADA87B3F6398C11348613B633A9408B5CD9AFF29C939C7E1D659F9AA062C317B7B45D7FB4FB963D55D56AF1939119BBEF5315A91492A75CD5B5D6D96E9C7673CF5C6ED80E04E8BF0CC05F3261CADB9E9AC61CE9FFA53FC5C7C47C2FF49B4FB781959AA055C345166FC4D5E2E23C44CAE6C56797A6D3AE571663A13BC897E240F06C7A66489BDC1F05DAE","singValue":"A26E178E5810E896066FE1A417506E97"}`
合作商在接收到请求时，用私钥解密。
返回时数据不用加密 还是跟之前一样

## 记账结果通知（数据不加密）

### 请求参数

| **序号** | **中文域名** | **英文域名** | **类型** | **域中值的填写方法** |
| :---: | :--- | :--- | :--- | :---: |
| 1 | 结算日期 | BalDate | Char\(8\) | YYYYMMDD |
| 2 | 合作商号 | AgentId | Char\(10\) |  |
| 3 | 交易流水号 | TxnLogId | Char\(6\) | 对应交易上送的tradeNo字段 |
| 4 | 收单商户号 | BusinessId | Char\(15\) |  |
| 5 | 收单终端号 | SDTermNo | Char\(32\) |  |
| 6 | 交易码 | TxnCode | Char\(4\) | N001：扫手机<br> N002：扫POS<br> N007：公众号支付<br> L005：扫码退款<br> L020：银行卡消费<br> L030：银行卡撤销<br> L009：银行卡冲正<br> 4433040：台牌微信<br> 4433050：台牌支付宝<br> 2010060：预授权完成<br> 2010070：预授权完成撤销 |
| 7 | 支付通道 | PayChannel | Char\(2\) | 1.支付宝ISV <br>             2.微信支付 <br>              3.百度百付宝 <br>                  4.苏宁易付宝    <br>     5.支付宝城市服务商<br> 6 京东钱包<br>                  7.QQ钱包    <br>               8 翼支付 |
| 8 | 交易日期 | TxnDate | Char\(8\) | YYYYMMDD |
| 9 | 交易时间 | TxnTime | Char\(6\) | HHMMSS |
| 10 | 交易金额 | TxnAmt | Char\(10\) | 按元为单位填写 |
| 11 | 交易状态 | TxnStatus | CHAR\(1\) | 1：成功 |
| 12 | 支付银行 | BankType | Char\(20\) | 返回的支付银行 |
| 13 | 支付通道订单号 | OfficeId | Char\(64\) | 微信/支付宝订单号 |
| 14 | 商户单号 | ChannelId | Char\(64\) | 对应交易上送selOrderNo字段 |
| 15 | C端用户信息 | UserId | Char\(64\) | C端支付用户信息 |
| 16 | 平台流水号 | logNo | Char\(20\) |  |
|18|附加信息|attach|Char(64)|附加信息|
| 17 | 银行卡借贷记标识 | CrdFlg | Char\(1\) | 1:借记卡 <br>2：贷记卡 |

### 返回参数

| **序号** | **中文域名** | **英文域名** | **类型** | **域中值的填写方法** |
| :---: | :--- | :--- | :--- | :--- |
| 1 | 响应码 | RspCode | Char\(6\) | 000000成功，其它失败 |
| 2 | 描述 | RspDes | Char\(64\) | 不足右补空格 |

## 记账结果通知（数据加密）
### 请求参数

| **序号** | **中文域名** | **英文域名** | **类型** | **域中值的填写方法** |
| :---: | :--- | :--- | :--- | :--- |
|1	|推送数据|	Datas|	Char(10240)	|看2.1.3加密加签说明
|2	|签名	|signValue	|Char(128)	|MD5加签数据

### 返回参数

| **序号** | **中文域名** | **英文域名** | **类型** | **域中值的填写方法** |
| :---: | :--- | :--- | :--- | :--- |
|1|响应码|RspCode|Char(6)|000000成功，其它失败
|2|描述	|RspDes	|Char(64)|不足右补空格







